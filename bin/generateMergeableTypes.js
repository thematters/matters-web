const { isObjectType, isInterfaceType } = require('graphql')

module.exports = {
  plugin: (schema) => {
    const typesMap = schema.getTypeMap()

    let contents =
      '/* Generated by bin/generateApolloMergeableTypes.js; DO NOT EDIT. */\n\n'

    contents += 'export const mergeables = [\n'

    Object.keys(typesMap).forEach((typeName) => {
      const type = typesMap[typeName]

      if (
        (!typeName.startsWith('__') && isObjectType(type)) ||
        isInterfaceType(type)
      ) {
        contents += `  '${typeName}',\n`
      }
    })

    contents += ']\n'

    return contents
  },
}
