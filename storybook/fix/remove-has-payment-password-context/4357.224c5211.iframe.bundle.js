"use strict";(self.webpackChunkmatters_web=self.webpackChunkmatters_web||[]).push([[4357],{"./src/common/utils/form/validate.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{kQ:()=>validateCollectionTitle,tZ:()=>validateDisplayName});var enums=__webpack_require__("./src/common/enums/index.ts"),hardcode_RESERVED_NAMES=["matters","matty","馬特市官方","马特市官方","張潔平","张洁平"],REGEXP_ALL_PUNCTUATIONS=new RegExp("^[".concat("。？！，、；：“”‘’（）《》〈〉【】『』「」﹃﹄〔〕…—～﹏￥").concat("\0-/:-@[-`z-","]*$")),validateCollectionTitle=function validateCollectionTitle(value,intl){return value?value.length<enums.vH||value.length>enums.Mc?intl.formatMessage({defaultMessage:"Must be between {MIN_COLLECTION_TITLE_LENGTH}-{MAX_COLLECTION_TITLE_LENGTH} characters long.",id:"El+nq2"},{MAX_COLLECTION_TITLE_LENGTH:enums.Mc,MIN_COLLECTION_TITLE_LENGTH:enums.vH}):void 0:intl.formatMessage({defaultMessage:"Required",id:"Seanpx"})},validateDisplayName=function validateDisplayName(value,intl,isAdmin){if(!value)return intl.formatMessage({defaultMessage:"Required",id:"Seanpx"});if(value.length<enums.Fm)return intl.formatMessage({defaultMessage:"Must be between {MIN_USER_DISPLAY_NAME_LENGTH}-{MAX_USER_DISPLAY_NAME_LENGTH} characters long.",id:"ruZqtT"},{MIN_USER_DISPLAY_NAME_LENGTH:enums.Fm,MAX_USER_DISPLAY_NAME_LENGTH:enums.cW});if(value.length>enums.cW)return intl.formatMessage({defaultMessage:"Must be between {MIN_USER_DISPLAY_NAME_LENGTH}-{MAX_USER_DISPLAY_NAME_LENGTH} characters long.",id:"ruZqtT"},{MIN_USER_DISPLAY_NAME_LENGTH:enums.Fm,MAX_USER_DISPLAY_NAME_LENGTH:enums.cW});var invalidNameIndex=hardcode_RESERVED_NAMES.indexOf(value.toLowerCase());return invalidNameIndex>=0&&!isAdmin?intl.formatMessage({defaultMessage:'"{name}" is invalid.',id:"i4OBEw"},{name:hardcode_RESERVED_NAMES[invalidNameIndex]}):REGEXP_ALL_PUNCTUATIONS.test(value)?intl.formatMessage({defaultMessage:"Not support using punctuation marks alone.",id:"yubNcI"}):void 0}},"./src/components/Dialogs/AddCollectionDialog/Content.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _templateObject,_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_taggedTemplateLiteral_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__),formik__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/formik/dist/formik.esm.js"),graphql_tag__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/graphql-tag/lib/index.js"),lodash_pickBy__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/lodash/pickBy.js"),lodash_pickBy__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(lodash_pickBy__WEBPACK_IMPORTED_MODULE_3__),next_router__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/next/router.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_intl__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/react-intl/lib/src/components/useIntl.js"),react_intl__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("./node_modules/react-intl/lib/src/components/message.js"),_common_enums__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./src/common/enums/keyValue.ts"),_common_utils__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./src/common/utils/form/validate.ts"),_common_utils__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./src/common/utils/route.ts"),_components__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/components/CollectionDigest/Feed/index.tsx"),_components__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/components/Context/Viewer/index.tsx"),_components__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./src/components/GQL/hooks.ts"),_components__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./src/components/Hook/useRoute.ts"),_components__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./src/components/Form/index.tsx"),_components__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./src/components/Dialog/index.tsx"),_views_User_Collections_gql__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./src/views/User/Collections/gql.ts"),_views_User_UserProfile_gql__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./src/views/User/UserProfile/gql.ts"),__jsx=react__WEBPACK_IMPORTED_MODULE_0__.createElement,CREATE_COLLECTION=(0,graphql_tag__WEBPACK_IMPORTED_MODULE_5__.ZP)(_templateObject||(_templateObject=(0,_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_taggedTemplateLiteral_js__WEBPACK_IMPORTED_MODULE_6__.Z)(["\n  mutation CreateCollection($input: PutCollectionInput!) {\n    putCollection(input: $input) {\n      id\n      ...CollectionDigestFeedCollection\n    }\n  }\n  ","\n"])),_components__WEBPACK_IMPORTED_MODULE_7__.z.fragments.collection);const __WEBPACK_DEFAULT_EXPORT__=function AddCollectionDialogContent(_ref){var _onSubmit,closeDialog=_ref.closeDialog,onUpdate=_ref.onUpdate,gotoDetailPage=_ref.gotoDetailPage,intl=(0,react_intl__WEBPACK_IMPORTED_MODULE_8__.Z)(),viewer=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_components__WEBPACK_IMPORTED_MODULE_9__.Zd),_useMutation=(0,_components__WEBPACK_IMPORTED_MODULE_10__.Db)(CREATE_COLLECTION,void 0,{showToast:!1}),create=(0,_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_11__.Z)(_useMutation,1)[0],userName=(0,(0,_components__WEBPACK_IMPORTED_MODULE_12__.y)().getQuery)("name"),router=(0,next_router__WEBPACK_IMPORTED_MODULE_4__.useRouter)(),formId="edit-new-collection-form",_useFormik=(0,formik__WEBPACK_IMPORTED_MODULE_2__.useFormik)({initialValues:{title:""},validateOnBlur:!1,validateOnChange:!1,validate:function validate(_ref2){var title=_ref2.title;return lodash_pickBy__WEBPACK_IMPORTED_MODULE_3___default()({title:(0,_common_utils__WEBPACK_IMPORTED_MODULE_13__.kQ)(title,intl)})},onSubmit:(_onSubmit=(0,_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_14__.Z)(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee(_ref3,_ref4){var title,setSubmitting,_yield$create,data,path;return _home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return title=_ref3.title,setSubmitting=_ref4.setSubmitting,_ref4.setFieldError,_context.prev=2,_context.next=5,create({variables:{input:{title}},update:function update(cache,result){var _result$data;onUpdate&&onUpdate(cache,(null===(_result$data=result.data)||void 0===_result$data?void 0:_result$data.putCollection)||{})},refetchQueries:[{query:_views_User_Collections_gql__WEBPACK_IMPORTED_MODULE_15__.USER_COLLECTIONS,variables:{userName:viewer.userName}},{query:_views_User_UserProfile_gql__WEBPACK_IMPORTED_MODULE_16__.USER_PROFILE_PUBLIC,variables:{userName:viewer.userName}}]});case 5:_yield$create=_context.sent,data=_yield$create.data,setSubmitting(!1),gotoDetailPage&&data&&(path=(0,_common_utils__WEBPACK_IMPORTED_MODULE_17__.y3)({page:"collectionDetail",userName,collection:data.putCollection}),router.push(path.href)),closeDialog(),_context.next=15;break;case 12:_context.prev=12,_context.t0=_context.catch(2),setSubmitting(!1);case 15:case"end":return _context.stop()}}),_callee,null,[[2,12]])}))),function onSubmit(_x,_x2){return _onSubmit.apply(this,arguments)})}),values=_useFormik.values,errors=_useFormik.errors,touched=_useFormik.touched,handleBlur=_useFormik.handleBlur,handleChange=_useFormik.handleChange,handleSubmit=_useFormik.handleSubmit,isSubmitting=_useFormik.isSubmitting,InnerForm=__jsx(_components__WEBPACK_IMPORTED_MODULE_18__.l,{id:formId,onSubmit:handleSubmit},__jsx(_components__WEBPACK_IMPORTED_MODULE_18__.l.Input,{type:"text",name:"title",required:!0,placeholder:intl.formatMessage({defaultMessage:"Collection Name",id:"VZsE96"}),value:values.title,hint:"".concat(values.title.length,"/").concat(40),error:touched.title&&errors.title,hintAlign:touched.title&&errors.title?"left":"right",onBlur:handleBlur,onChange:handleChange,maxLength:40,onKeyDown:function onKeyDown(e){e.key.toLocaleLowerCase()===_common_enums__WEBPACK_IMPORTED_MODULE_19__.T.enter&&e.stopPropagation()}})),SubmitButton=__jsx(_components__WEBPACK_IMPORTED_MODULE_20__.V.TextButton,{type:"submit",form:formId,disabled:isSubmitting,text:__jsx(react_intl__WEBPACK_IMPORTED_MODULE_21__.Z,{defaultMessage:"Create",id:"VzzYJk"}),loading:isSubmitting});return __jsx(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,__jsx(_components__WEBPACK_IMPORTED_MODULE_20__.V.Header,{title:__jsx(react_intl__WEBPACK_IMPORTED_MODULE_21__.Z,{defaultMessage:"New Collection",id:"L4Fcr8"}),closeDialog,rightBtn:SubmitButton}),__jsx(_components__WEBPACK_IMPORTED_MODULE_20__.V.Content,null,InnerForm),__jsx(_components__WEBPACK_IMPORTED_MODULE_20__.V.Footer,{smUpBtns:__jsx(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,__jsx(_components__WEBPACK_IMPORTED_MODULE_20__.V.TextButton,{text:__jsx(react_intl__WEBPACK_IMPORTED_MODULE_21__.Z,{defaultMessage:"Cancel",id:"47FYwb"}),color:"greyDarker",onClick:closeDialog}),SubmitButton)}))};try{Content.displayName="Content",Content.__docgenInfo={description:"",displayName:"Content",props:{closeDialog:{defaultValue:null,description:"",name:"closeDialog",required:!0,type:{name:"() => void"}},onUpdate:{defaultValue:null,description:"",name:"onUpdate",required:!1,type:{name:'((cache: any, collection: { __typename?: "Collection"; id: string; title: string; description?: string | null; cover?: string | null | undefined; updatedAt: any; pinned: boolean; author: { ...; }; articles: { ...; }; }) => void) | undefined'}},gotoDetailPage:{defaultValue:null,description:"",name:"gotoDetailPage",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Dialogs/AddCollectionDialog/Content.tsx#Content"]={docgenInfo:Content.__docgenInfo,name:"Content",path:"src/components/Dialogs/AddCollectionDialog/Content.tsx#Content"})}catch(__react_docgen_typescript_loader_error){}}}]);