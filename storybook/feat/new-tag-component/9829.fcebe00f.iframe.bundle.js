(self.webpackChunkmatters_web=self.webpackChunkmatters_web||[]).push([[9829],{"./src/components/CollectionDigest/DropdownActions/EditCollection/Dialog/Content.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _templateObject,_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_taggedTemplateLiteral_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__),formik__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/formik/dist/formik.esm.js"),graphql_tag__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/graphql-tag/lib/index.js"),lodash_pickBy__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/lodash/pickBy.js"),lodash_pickBy__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(lodash_pickBy__WEBPACK_IMPORTED_MODULE_4__),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_intl__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/react-intl/lib/src/components/useIntl.js"),react_intl__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./node_modules/react-intl/lib/src/components/message.js"),_public_static_images_profile_cover_png__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./public/static/images/profile-cover.png"),_common_enums__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./src/common/enums/file.ts"),_common_enums__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./src/common/enums/index.ts"),_common_utils__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/common/utils/storage.ts"),_components__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/components/Context/Viewer/index.tsx"),_components__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./src/components/GQL/hooks.ts"),_components__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./src/components/Form/index.tsx"),_components__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./src/components/FileUploader/CoverUploader/index.tsx"),_components__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./src/components/Dialog/index.tsx"),_views_User_Collections_gql__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./src/views/User/Collections/gql.ts"),__jsx=react__WEBPACK_IMPORTED_MODULE_0__.createElement;function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_2__.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var PUT_COLLECTION=(0,graphql_tag__WEBPACK_IMPORTED_MODULE_5__.ZP)(_templateObject||(_templateObject=(0,_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_taggedTemplateLiteral_js__WEBPACK_IMPORTED_MODULE_6__.Z)(["\n  mutation PutCollection($input: PutCollectionInput!) {\n    putCollection(input: $input) {\n      id\n      title\n      description\n      cover\n    }\n  }\n"])));const __WEBPACK_DEFAULT_EXPORT__=function EditCollectionDialogContent(_ref){var _onSubmit,collection=_ref.collection,closeDialog=_ref.closeDialog,intl=(0,react_intl__WEBPACK_IMPORTED_MODULE_7__.Z)(),viewer=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_components__WEBPACK_IMPORTED_MODULE_8__.Zd),formId="edit-collection-form",formStorageKey=_common_utils__WEBPACK_IMPORTED_MODULE_9__.np.genKey({authorId:viewer.id,formId}),formDraft=_common_utils__WEBPACK_IMPORTED_MODULE_9__.np.get(formStorageKey,"session"),_useMutation=(0,_components__WEBPACK_IMPORTED_MODULE_10__.Db)(PUT_COLLECTION,void 0,{showToast:!1}),update=(0,_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_11__.Z)(_useMutation,1)[0],validateTitle=function validateTitle(value){if(!value)return intl.formatMessage({defaultMessage:"Required",id:"Seanpx"})},_useFormik=(0,formik__WEBPACK_IMPORTED_MODULE_3__.useFormik)({initialValues:{cover:(null==formDraft?void 0:formDraft.cover)||"UNCHANGED_FIELD",title:(null==formDraft?void 0:formDraft.title)||collection.title||"",description:(null==formDraft?void 0:formDraft.description)||collection.description||""},validateOnBlur:!1,validateOnChange:!1,validate:function validate(_ref2){var title=_ref2.title;return lodash_pickBy__WEBPACK_IMPORTED_MODULE_4___default()({displayName:validateTitle(title)})},onSubmit:(_onSubmit=(0,_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_12__.Z)(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee(_ref3,_ref4){var cover,title,description,setSubmitting;return _home_runner_work_matters_web_matters_web_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return cover=_ref3.cover,title=_ref3.title,description=_ref3.description,setSubmitting=_ref4.setSubmitting,_ref4.setFieldError,_context.prev=2,_context.next=5,update({variables:{input:_objectSpread(_objectSpread({id:collection.id},"UNCHANGED_FIELD"!==cover?{cover}:{}),{},{title,description})},refetchQueries:[{query:_views_User_Collections_gql__WEBPACK_IMPORTED_MODULE_13__.USER_COLLECTIONS,variables:{userName:viewer.userName}}]});case 5:_common_utils__WEBPACK_IMPORTED_MODULE_9__.np.remove(formStorageKey,"session"),setSubmitting(!1),closeDialog(),_context.next=13;break;case 10:_context.prev=10,_context.t0=_context.catch(2),setSubmitting(!1);case 13:case"end":return _context.stop()}}),_callee,null,[[2,10]])}))),function onSubmit(_x,_x2){return _onSubmit.apply(this,arguments)})}),values=_useFormik.values,errors=_useFormik.errors,touched=_useFormik.touched,handleBlur=_useFormik.handleBlur,handleChange=_useFormik.handleChange,handleSubmit=_useFormik.handleSubmit,isSubmitting=_useFormik.isSubmitting,setFieldValue=_useFormik.setFieldValue,_useState=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),coverLoading=_useState[0],setCoverLoading=_useState[1],InnerForm=__jsx(_components__WEBPACK_IMPORTED_MODULE_14__.l,{id:formId,onSubmit:handleSubmit},__jsx(_components__WEBPACK_IMPORTED_MODULE_15__.D,{assetType:_common_enums__WEBPACK_IMPORTED_MODULE_16__.tP.collectionCover,entityId:collection.id,cover:(null==formDraft?void 0:formDraft.coverPath)||collection.cover,fallbackCover:_public_static_images_profile_cover_png__WEBPACK_IMPORTED_MODULE_17__.Z.src,entityType:_common_enums__WEBPACK_IMPORTED_MODULE_16__.lU.collection,inEditor:!0,onUploaded:function onUploaded(assetId,path){setFieldValue("cover",assetId),_common_utils__WEBPACK_IMPORTED_MODULE_9__.np.set(formStorageKey,_objectSpread(_objectSpread({},values),{},{cover:assetId,coverPath:path}),"session")},onUploadStart:function onUploadStart(){return setCoverLoading(!0)},onUploadEnd:function onUploadEnd(){return setCoverLoading(!1)},onReset:function onReset(){setFieldValue("cover",null),_common_utils__WEBPACK_IMPORTED_MODULE_9__.np.set(formStorageKey,_objectSpread(_objectSpread({},values),{},{cover:null,coverPath:null}),"session")},type:"collection",bookTitle:values.title}),__jsx(_components__WEBPACK_IMPORTED_MODULE_14__.l.Input,{type:"text",name:"title",required:!0,placeholder:intl.formatMessage({defaultMessage:"Collection name",id:"A6ozr9"}),value:values.title,hint:"".concat(values.title.length,"/").concat(_common_enums__WEBPACK_IMPORTED_MODULE_18__.Mc),error:touched.title&&errors.title,hintAlign:touched.title&&errors.title?"left":"right",onBlur:handleBlur,onChange:function onChange(e){handleChange(e),_common_utils__WEBPACK_IMPORTED_MODULE_9__.np.set(formStorageKey,_objectSpread(_objectSpread({},values),{},{title:e.target.value}),"session")},maxLength:_common_enums__WEBPACK_IMPORTED_MODULE_18__.Mc,spacingTop:"loose",spacingBottom:"base"}),__jsx(_components__WEBPACK_IMPORTED_MODULE_14__.l.Textarea,{name:"description",placeholder:intl.formatMessage({defaultMessage:"Description",id:"Q8Qw5B"}),maxLength:_common_enums__WEBPACK_IMPORTED_MODULE_18__.uE$,value:values.description,hint:"".concat(values.description.length,"/").concat(_common_enums__WEBPACK_IMPORTED_MODULE_18__.uE$),error:touched.description&&errors.description,hintAlign:touched.description&&errors.description?"left":"right",onBlur:handleBlur,onChange:function onChange(e){handleChange(e),_common_utils__WEBPACK_IMPORTED_MODULE_9__.np.set(formStorageKey,_objectSpread(_objectSpread({},values),{},{description:e.target.value}),"session")}})),SubmitButton=__jsx(_components__WEBPACK_IMPORTED_MODULE_19__.V.TextButton,{type:"submit",form:formId,disabled:isSubmitting||coverLoading,text:__jsx(react_intl__WEBPACK_IMPORTED_MODULE_20__.Z,{defaultMessage:"Confirm",id:"N2IrpM"}),loading:isSubmitting||coverLoading});return __jsx(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,__jsx(_components__WEBPACK_IMPORTED_MODULE_19__.V.Header,{title:__jsx(react_intl__WEBPACK_IMPORTED_MODULE_20__.Z,{defaultMessage:"Edit collection",id:"WQT8ZA"}),closeDialog,rightBtn:SubmitButton}),__jsx(_components__WEBPACK_IMPORTED_MODULE_19__.V.Content,null,InnerForm),__jsx(_components__WEBPACK_IMPORTED_MODULE_19__.V.Footer,{smUpBtns:__jsx(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,__jsx(_components__WEBPACK_IMPORTED_MODULE_19__.V.TextButton,{text:__jsx(react_intl__WEBPACK_IMPORTED_MODULE_20__.Z,{defaultMessage:"Cancel",id:"47FYwb"}),color:"greyDarker",onClick:closeDialog}),SubmitButton)}))};try{Content.displayName="Content",Content.__docgenInfo={description:"",displayName:"Content",props:{collection:{defaultValue:null,description:"",name:"collection",required:!0,type:{name:"EditCollectionCollectionFragment"}},closeDialog:{defaultValue:null,description:"",name:"closeDialog",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/CollectionDigest/DropdownActions/EditCollection/Dialog/Content.tsx#Content"]={docgenInfo:Content.__docgenInfo,name:"Content",path:"src/components/CollectionDigest/DropdownActions/EditCollection/Dialog/Content.tsx#Content"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/lodash/_baseFlatten.js":(module,__unused_webpack_exports,__webpack_require__)=>{var arrayPush=__webpack_require__("./node_modules/lodash/_arrayPush.js"),isFlattenable=__webpack_require__("./node_modules/lodash/_isFlattenable.js");module.exports=function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;for(predicate||(predicate=isFlattenable),result||(result=[]);++index<length;){var value=array[index];depth>0&&predicate(value)?depth>1?baseFlatten(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}},"./node_modules/lodash/_baseSlice.js":module=>{module.exports=function baseSlice(array,start,end){var index=-1,length=array.length;start<0&&(start=-start>length?0:length+start),(end=end>length?length:end)<0&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}},"./node_modules/lodash/_baseUnset.js":(module,__unused_webpack_exports,__webpack_require__)=>{var castPath=__webpack_require__("./node_modules/lodash/_castPath.js"),last=__webpack_require__("./node_modules/lodash/last.js"),parent=__webpack_require__("./node_modules/lodash/_parent.js"),toKey=__webpack_require__("./node_modules/lodash/_toKey.js");module.exports=function baseUnset(object,path){return path=castPath(path,object),null==(object=parent(object,path))||delete object[toKey(last(path))]}},"./node_modules/lodash/_customOmitClone.js":(module,__unused_webpack_exports,__webpack_require__)=>{var isPlainObject=__webpack_require__("./node_modules/lodash/isPlainObject.js");module.exports=function customOmitClone(value){return isPlainObject(value)?void 0:value}},"./node_modules/lodash/_flatRest.js":(module,__unused_webpack_exports,__webpack_require__)=>{var flatten=__webpack_require__("./node_modules/lodash/flatten.js"),overRest=__webpack_require__("./node_modules/lodash/_overRest.js"),setToString=__webpack_require__("./node_modules/lodash/_setToString.js");module.exports=function flatRest(func){return setToString(overRest(func,void 0,flatten),func+"")}},"./node_modules/lodash/_isFlattenable.js":(module,__unused_webpack_exports,__webpack_require__)=>{var Symbol=__webpack_require__("./node_modules/lodash/_Symbol.js"),isArguments=__webpack_require__("./node_modules/lodash/isArguments.js"),isArray=__webpack_require__("./node_modules/lodash/isArray.js"),spreadableSymbol=Symbol?Symbol.isConcatSpreadable:void 0;module.exports=function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}},"./node_modules/lodash/_parent.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseGet=__webpack_require__("./node_modules/lodash/_baseGet.js"),baseSlice=__webpack_require__("./node_modules/lodash/_baseSlice.js");module.exports=function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}},"./node_modules/lodash/flatten.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseFlatten=__webpack_require__("./node_modules/lodash/_baseFlatten.js");module.exports=function flatten(array){return(null==array?0:array.length)?baseFlatten(array,1):[]}},"./node_modules/lodash/last.js":module=>{module.exports=function last(array){var length=null==array?0:array.length;return length?array[length-1]:void 0}},"./node_modules/lodash/omit.js":(module,__unused_webpack_exports,__webpack_require__)=>{var arrayMap=__webpack_require__("./node_modules/lodash/_arrayMap.js"),baseClone=__webpack_require__("./node_modules/lodash/_baseClone.js"),baseUnset=__webpack_require__("./node_modules/lodash/_baseUnset.js"),castPath=__webpack_require__("./node_modules/lodash/_castPath.js"),copyObject=__webpack_require__("./node_modules/lodash/_copyObject.js"),customOmitClone=__webpack_require__("./node_modules/lodash/_customOmitClone.js"),flatRest=__webpack_require__("./node_modules/lodash/_flatRest.js"),getAllKeysIn=__webpack_require__("./node_modules/lodash/_getAllKeysIn.js"),omit=flatRest((function(object,paths){var result={};if(null==object)return result;var isDeep=!1;paths=arrayMap(paths,(function(path){return path=castPath(path,object),isDeep||(isDeep=path.length>1),path})),copyObject(object,getAllKeysIn(object),result),isDeep&&(result=baseClone(result,7,customOmitClone));for(var length=paths.length;length--;)baseUnset(result,paths[length]);return result}));module.exports=omit}}]);