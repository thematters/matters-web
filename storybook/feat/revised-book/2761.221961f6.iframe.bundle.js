(self.webpackChunkmatters_web=self.webpackChunkmatters_web||[]).push([[2761],{"./src/components/Dialogs/FingerprintDialog/Content.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>FingerprintDialog_Content});var slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),taggedTemplateLiteral=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js"),react=__webpack_require__("./node_modules/react/index.js"),react_hooks_esm=__webpack_require__("./node_modules/@apollo/react-hooks/lib/react-hooks.esm.js"),lib=__webpack_require__("./node_modules/graphql-tag/lib/index.js"),useIntl=__webpack_require__("./node_modules/react-intl/lib/src/components/useIntl.js"),translate=__webpack_require__("./src/common/utils/translate.ts"),iscnLinkPrefix="production"===__webpack_require__("./node_modules/process/browser.js").env.NEXT_PUBLIC_RUNTIME_ENV?"https://app.like.co/view":"https://app.rinkeby.like.co/view";function iscnLinkUrl(iscnId){return"".concat(iscnLinkPrefix,"/").concat(encodeURIComponent(iscnId))}var _templateObject,LanguageContext=__webpack_require__("./src/components/Context/Language/LanguageContext.tsx"),hooks=__webpack_require__("./src/components/GQL/hooks.ts"),Dialog=__webpack_require__("./src/components/Dialog/index.tsx"),TextIcon=__webpack_require__("./src/components/TextIcon/index.tsx"),IconIPFSGreen24=__webpack_require__("./src/components/Icon/IconIPFSGreen24.tsx"),Translate=__webpack_require__("./src/components/Context/Language/Translate.tsx"),Spacer=__webpack_require__("./src/components/Spacer/index.tsx"),Spinner=__webpack_require__("./src/components/Spinner/index.tsx"),IconExternalLink16=__webpack_require__("./src/components/Icon/IconExternalLink16.tsx"),CopyToClipboard=__webpack_require__("./src/components/CopyToClipboard/index.tsx"),Button=__webpack_require__("./src/components/Button/index.tsx"),IconCopy16=__webpack_require__("./src/components/Icon/IconCopy16.tsx"),IconISCN24=__webpack_require__("./src/components/Icon/IconISCN24.tsx"),styles_module=__webpack_require__("./src/components/Dialogs/FingerprintDialog/styles.module.css"),__jsx=react.createElement,QUERY_SECRET=(0,lib.ZP)(_templateObject||(_templateObject=(0,taggedTemplateLiteral.Z)(["\n  query ArticleSecret($id: ID!) {\n    article: node(input: { id: $id }) {\n      ... on Article {\n        id\n        access {\n          secret\n        }\n      }\n    }\n  }\n"]))),ArticleSecretSection=function ArticleSecretSection(_ref){var _article$access,id=_ref.id,intl=(0,useIntl.Z)(),data=(0,react_hooks_esm.aM)(QUERY_SECRET,{variables:{id}}).data,article=null==data?void 0:data.article,secret="Article"===(null==article?void 0:article.__typename)?null==article||null===(_article$access=article.access)||void 0===_article$access?void 0:_article$access.secret:void 0;return secret?__jsx("section",{className:styles_module.Z.secret},__jsx("p",{className:styles_module.Z.description},__jsx(Translate.v,{zh_hant:"上鎖內容密鑰，請妥善保管",zh_hans:"上鎖內容密鑰，請妥善保管",en:"The key for locked content, please save securely"})),__jsx("section",{className:styles_module.Z.key},__jsx(CopyToClipboard.h,{text:secret},__jsx("button",{"aria-label":intl.formatMessage({defaultMessage:"Copy",id:"4l6vz1"}),className:styles_module.Z.copyButton},__jsx(TextIcon.V,{icon:__jsx(IconCopy16.IconCopy16,null),textPlacement:"left",spacing:"xtight"},secret.slice(0,4),"...",secret.slice(-4)))))):null};ArticleSecretSection.displayName="ArticleSecretSection";const FingerprintDialog_ArticleSecret=ArticleSecretSection;try{ArticleSecret.displayName="ArticleSecret",ArticleSecret.__docgenInfo={description:"",displayName:"ArticleSecret",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Dialogs/FingerprintDialog/ArticleSecret.tsx#ArticleSecret"]={docgenInfo:ArticleSecret.__docgenInfo,name:"ArticleSecret",path:"src/components/Dialogs/FingerprintDialog/ArticleSecret.tsx#ArticleSecret"})}catch(__react_docgen_typescript_loader_error){}var Content_templateObject,_templateObject2,SectionCard=__webpack_require__("./src/components/Dialogs/FingerprintDialog/SectionCard/index.tsx"),Content_jsx=react.createElement,EDIT_ARTICLE=(0,lib.ZP)(Content_templateObject||(Content_templateObject=(0,taggedTemplateLiteral.Z)(["\n  mutation RetryEditArticle($id: ID!, $iscnPublish: Boolean) {\n    editArticle(input: { id: $id, iscnPublish: $iscnPublish }) {\n      id\n      cover\n      access {\n        type\n      }\n      license\n      iscnId\n      drafts {\n        id\n        mediaHash\n        publishState\n        iscnPublish\n      }\n    }\n  }\n"]))),GATEWAYS=(0,lib.ZP)(_templateObject2||(_templateObject2=(0,taggedTemplateLiteral.Z)(["\n  query Gateways {\n    official {\n      gatewayUrls @client\n    }\n  }\n"]))),FingerprintDialogContent=function FingerprintDialogContent(_ref){var dataHash=_ref.dataHash,showSecret=_ref.showSecret,isAuthor=_ref.isAuthor,iscnId=_ref.iscnId,iscnPublish=_ref.iscnPublish,articleId=_ref.articleId,articleLastModified=_ref.articleLastModified,pending=_ref.pending,refetch=_ref.refetch,intl=(0,useIntl.Z)(),lang=(0,react.useContext)(LanguageContext.AZ).lang,_useQuery=(0,react_hooks_esm.aM)(GATEWAYS),loading=_useQuery.loading,data=_useQuery.data,gateways=(null==data?void 0:data.official.gatewayUrls)||[],_useMutation=(0,hooks.Db)(EDIT_ARTICLE),_useMutation2=(0,slicedToArray.Z)(_useMutation,2),editArticle=_useMutation2[0],retryPublishing=_useMutation2[1].loading,_useState=(0,react.useState)(!1),timeCooling=_useState[0],setTimeCooling=_useState[1],timer=null,pooling=function pooling(startedAt){if(startedAt){Date.now()-startedAt<3e4&&(setTimeCooling(!0),timer=setTimeout((function loop(){iscnId||Date.now()-startedAt>=3e4?(setTimeCooling(!1),timer=null):(refetch(),timer=setTimeout(loop,5e3))}),5e3))}};return(0,react.useEffect)((function(){if(!iscnId&&articleLastModified)return pooling(Date.parse(articleLastModified)),function(){timer&&(clearTimeout(timer),timer=null)}})),Content_jsx(Dialog.V.Content,null,Content_jsx("section",{className:styles_module.Z.container},Content_jsx(SectionCard.Z,{title:Content_jsx(TextIcon.V,{icon:Content_jsx(IconIPFSGreen24.IconIPFSGreen24,{size:"mdXS"}),spacing:"xtight",size:"xm",weight:"md"},"IPFS"),description:Content_jsx(Translate.v,{zh_hant:"去中心化內容存儲網絡",zh_hans:"去中心化內容存儲網絡",en:"Decentralized Content Storage Network"})},Content_jsx(Spacer.L,{size:"base"}),Content_jsx("hr",null),Content_jsx(Spacer.L,{size:"base"}),Content_jsx("section",{className:styles_module.Z.gateways},Content_jsx("h4",{className:styles_module.Z.title},Content_jsx(Translate.v,{zh_hans:"公共节点",zh_hant:"公共節點",en:"Public Gateways"})),Content_jsx("p",{className:styles_module.Z.description},Content_jsx(Translate.v,{zh_hans:"內容分佈節點，可以複製以下地址對作品進行傳播",zh_hant:"內容分佈節點，可以複製以下地址對作品進行傳播",en:"you may access via a decentralized gateway"})),Content_jsx("ul",{className:styles_module.Z.gatewayUrls},(!data||loading)&&Content_jsx(Spinner.$,null),gateways.slice(0,4).map((function(url){var gatewayUrl=url.replace(":hash",dataHash),hostname=url.replace(/(https:\/\/|\/ipfs\/|:hash.?)/g,"");return Content_jsx("li",{key:url},Content_jsx("a",{href:gatewayUrl,target:"_blank",rel:"noreferrer",className:styles_module.Z.gatewayUrl},hostname,Content_jsx(IconExternalLink16.IconExternalLink16,null)))})))),showSecret&&articleId&&Content_jsx(FingerprintDialog_ArticleSecret,{id:articleId}),Content_jsx(Spacer.L,{size:"base"}),Content_jsx("hr",null),Content_jsx(Spacer.L,{size:"base"}),Content_jsx("section",{className:styles_module.Z.hash},Content_jsx("h4",{className:styles_module.Z.title},Content_jsx(Translate.v,{id:"articleFingerprint"})),Content_jsx("p",{className:styles_module.Z.description},Content_jsx(Translate.v,{zh_hant:"使用 IPFS 生成的作品指紋，通過它可在節點調取內容",zh_hans:"使用 IPFS 生成的作品指紋，通過它可在節點調取內容",en:"The Fingerprint from IPFS, you can read it via a gateway"})),Content_jsx("section",{className:styles_module.Z.copy},Content_jsx("div",{className:styles_module.Z.hash},dataHash||(0,translate.I)({id:"waitingForHash",lang})),Content_jsx(CopyToClipboard.h,{text:dataHash},Content_jsx(Button.z,{"aria-label":intl.formatMessage({defaultMessage:"Copy",id:"4l6vz1"})},Content_jsx(IconCopy16.IconCopy16,null)))))),iscnPublish&&(isAuthor||iscnId)&&!timeCooling&&Content_jsx(react.Fragment,null,Content_jsx(Spacer.L,{size:"base"}),Content_jsx(SectionCard.Z,{title:Content_jsx(TextIcon.V,{icon:Content_jsx(IconISCN24.IconISCN24,{size:"mdXS"}),spacing:"xtight",size:"xm",weight:"md"},"ISCN"),description:Content_jsx(Translate.v,iscnId?{zh_hant:"已在 LikeCoin 鏈上註冊的元數據",zh_hans:"已在 LikeCoin 鏈上註冊的元數據",en:"The metadata registered on LikeCoin chain"}:{zh_hant:"ISCN 寫入未成功",zh_hans:"ISCN 写入未成功",en:"ISCN is failed to register on LikeCoin chain"}),warning:!iscnId,right:iscnId?Content_jsx("a",{href:iscnLinkUrl(iscnId),target:"_blank",rel:"noreferrer"},Content_jsx(IconExternalLink16.IconExternalLink16,{color:"greyDarker"})):isAuthor?Content_jsx(Button.z,{spacing:[0,"xtight"],size:[null,"1.5rem"],bgColor:"green",textColor:"white","aria-label":(0,translate.I)({id:"retry",lang}),disabled:!pending&&(timeCooling||retryPublishing),onClick:function onClick(){editArticle({variables:{id:articleId,iscnPublish:!0}}),setTimeCooling(!0),pooling(Date.now())}},Content_jsx(TextIcon.V,{size:"smS"},Content_jsx(Translate.v,timeCooling?{id:"publishing2"}:retryPublishing?{id:"retrying"}:{id:"retry"}))):Content_jsx(react.Fragment,null)}))))};FingerprintDialogContent.displayName="FingerprintDialogContent";const FingerprintDialog_Content=FingerprintDialogContent;try{Content.displayName="Content",Content.__docgenInfo={description:"",displayName:"Content",props:{dataHash:{defaultValue:null,description:"",name:"dataHash",required:!0,type:{name:"string"}},showSecret:{defaultValue:null,description:"",name:"showSecret",required:!0,type:{name:"boolean"}},isAuthor:{defaultValue:null,description:"",name:"isAuthor",required:!0,type:{name:"boolean"}},iscnId:{defaultValue:null,description:"",name:"iscnId",required:!0,type:{name:"string"}},iscnPublish:{defaultValue:null,description:"",name:"iscnPublish",required:!1,type:{name:"boolean"}},articleId:{defaultValue:null,description:"",name:"articleId",required:!1,type:{name:"string"}},articleLastModified:{defaultValue:null,description:"",name:"articleLastModified",required:!0,type:{name:"string"}},pending:{defaultValue:null,description:"",name:"pending",required:!0,type:{name:"boolean"}},refetch:{defaultValue:null,description:"",name:"refetch",required:!0,type:{name:"() => any"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Dialogs/FingerprintDialog/Content.tsx#Content"]={docgenInfo:Content.__docgenInfo,name:"Content",path:"src/components/Dialogs/FingerprintDialog/Content.tsx#Content"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/copy-to-clipboard/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var console=__webpack_require__("./node_modules/console-browserify/index.js"),deselectCurrent=__webpack_require__("./node_modules/toggle-selection/index.js"),clipboardToIE11Formatting={"text/plain":"Text","text/html":"Url",default:"Text"};module.exports=function copy(text,options){var debug,message,reselectPrevious,range,selection,mark,success=!1;options||(options={}),debug=options.debug||!1;try{if(reselectPrevious=deselectCurrent(),range=document.createRange(),selection=document.getSelection(),(mark=document.createElement("span")).textContent=text,mark.ariaHidden="true",mark.style.all="unset",mark.style.position="fixed",mark.style.top=0,mark.style.clip="rect(0, 0, 0, 0)",mark.style.whiteSpace="pre",mark.style.webkitUserSelect="text",mark.style.MozUserSelect="text",mark.style.msUserSelect="text",mark.style.userSelect="text",mark.addEventListener("copy",(function(e){if(e.stopPropagation(),options.format)if(e.preventDefault(),void 0===e.clipboardData){debug&&console.warn("unable to use e.clipboardData"),debug&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var format=clipboardToIE11Formatting[options.format]||clipboardToIE11Formatting.default;window.clipboardData.setData(format,text)}else e.clipboardData.clearData(),e.clipboardData.setData(options.format,text);options.onCopy&&(e.preventDefault(),options.onCopy(e.clipboardData))})),document.body.appendChild(mark),range.selectNodeContents(mark),selection.addRange(range),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");success=!0}catch(err){debug&&console.error("unable to copy using execCommand: ",err),debug&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(options.format||"text",text),options.onCopy&&options.onCopy(window.clipboardData),success=!0}catch(err){debug&&console.error("unable to copy using clipboardData: ",err),debug&&console.error("falling back to prompt"),message=function format(message){var copyKey=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return message.replace(/#{\s*key\s*}/g,copyKey)}("message"in options?options.message:"Copy to clipboard: #{key}, Enter"),window.prompt(message,text)}}finally{selection&&("function"==typeof selection.removeRange?selection.removeRange(range):selection.removeAllRanges()),mark&&document.body.removeChild(mark),reselectPrevious()}return success}},"./node_modules/react-copy-to-clipboard/lib/Component.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.CopyToClipboard=void 0;var _react=_interopRequireDefault(__webpack_require__("./node_modules/react/index.js")),_copyToClipboard=_interopRequireDefault(__webpack_require__("./node_modules/copy-to-clipboard/index.js")),_excluded=["text","onCopy","options","children"];function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}(this,result)}}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var CopyToClipboard=function(_React$PureComponent){!function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(CopyToClipboard,_React$PureComponent);var _super=_createSuper(CopyToClipboard);function CopyToClipboard(){var _this;!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CopyToClipboard);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _defineProperty(_assertThisInitialized(_this=_super.call.apply(_super,[this].concat(args))),"onClick",(function(event){var _this$props=_this.props,text=_this$props.text,onCopy=_this$props.onCopy,children=_this$props.children,options=_this$props.options,elem=_react.default.Children.only(children),result=(0,_copyToClipboard.default)(text,options);onCopy&&onCopy(text,result),elem&&elem.props&&"function"==typeof elem.props.onClick&&elem.props.onClick(event)})),_this}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(CopyToClipboard,[{key:"render",value:function render(){var _this$props2=this.props,children=(_this$props2.text,_this$props2.onCopy,_this$props2.options,_this$props2.children),props=_objectWithoutProperties(_this$props2,_excluded),elem=_react.default.Children.only(children);return _react.default.cloneElement(elem,_objectSpread(_objectSpread({},props),{},{onClick:this.onClick}))}}]),CopyToClipboard}(_react.default.PureComponent);exports.CopyToClipboard=CopyToClipboard,_defineProperty(CopyToClipboard,"defaultProps",{onCopy:void 0,options:void 0})},"./node_modules/react-copy-to-clipboard/lib/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var CopyToClipboard=__webpack_require__("./node_modules/react-copy-to-clipboard/lib/Component.js").CopyToClipboard;CopyToClipboard.CopyToClipboard=CopyToClipboard,module.exports=CopyToClipboard},"./node_modules/toggle-selection/index.js":module=>{module.exports=function(){var selection=document.getSelection();if(!selection.rangeCount)return function(){};for(var active=document.activeElement,ranges=[],i=0;i<selection.rangeCount;i++)ranges.push(selection.getRangeAt(i));switch(active.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":active.blur();break;default:active=null}return selection.removeAllRanges(),function(){"Caret"===selection.type&&selection.removeAllRanges(),selection.rangeCount||ranges.forEach((function(range){selection.addRange(range)})),active&&active.focus()}}}}]);